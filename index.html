<!doctype html>
<html lang="en">

<head>
  <title>SightWords Friend</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <style>
    /* CSS Reset and Base Styles */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #e3f2fd 0%, #f8f9fa 100%);
      min-height: 100vh;
      color: #2c3e50;
      line-height: 1.6;
    }

    /* Container and Layout */
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }

    .row {
      display: flex;
      flex-wrap: wrap;
      margin: -10px;
    }

    .col {
      flex: 1;
      min-width: 250px;
      padding: 10px;
    }

    .col-full {
      flex: 0 0 100%;
      padding: 10px;
    }

    /* Card Component */
    .card {
      background: white;
      border-radius: 20px;
      padding: 24px;
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      border: 3px solid transparent;
      margin-bottom: 20px;
    }

    .card:hover {
      transform: translateY(-2px);
      box-shadow: 0 12px 35px rgba(0, 0, 0, 0.15);
    }

    /* Colorblind-friendly color scheme */
    .card-navigation {
      background: linear-gradient(135deg, #4a90e2 0%, #357abd 100%);
      color: white;
      border-color: #2c5aa0;
    }

    .card-title {
      background: linear-gradient(135deg, #27ae60 0%, #219a52 100%);
      color: white;
      border-color: #1e8449;
    }

    .card-credits {
      background: linear-gradient(135deg, #8e44ad 0%, #7d3c98 100%);
      color: white;
      border-color: #6c3483;
    }

    .card-game {
      background: linear-gradient(135deg, #e67e22 0%, #d35400 100%);
      color: white;
      border-color: #ba4a00;
    }

    .card-wins {
      background: linear-gradient(135deg, #f39c12 0%, #e08e0b 100%);
      color: white;
      border-color: #ca6f1e;
    }

    .card-skipped {
      background: linear-gradient(135deg, #34495e 0%, #2c3e50 100%);
      color: white;
      border-color: #1b2631;
    }

    /* Typography */
    h1 {
      font-size: 2.5rem;
      font-weight: 700;
      text-align: center;
      margin-bottom: 0;
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
    }

    h2 {
      font-size: 2rem;
      margin-bottom: 1rem;
      text-align: center;
    }

    h3 {
      font-size: 1.8rem;
      margin-bottom: 1rem;
      text-align: center;
    }

    h4 {
      font-size: 1.5rem;
      margin-bottom: 1rem;
      text-align: center;
    }

    h5 {
      font-size: 1.2rem;
      margin-bottom: 0.5rem;
      text-align: center;
    }

    /* Links */
    a {
      color: white;
      text-decoration: none;
      font-weight: 600;
      transition: opacity 0.3s ease;
      border-bottom: 2px solid rgba(255, 255, 255, 0.3);
    }

    a:hover {
      opacity: 0.8;
      border-bottom-color: white;
    }

    /* Word Display */
    .word-display {
      font-size: clamp(4rem, 20vw, 12rem);
      font-weight: 900;
      text-align: center;
      margin: 30px 0;
      text-shadow: 3px 3px 6px rgba(0, 0, 0, 0.3);
      letter-spacing: 0.1em;
      color: white;
    }

    /* Buttons */
    .btn {
      display: inline-block;
      padding: 16px 32px;
      font-size: 1.4rem;
      font-weight: 700;
      border: none;
      border-radius: 50px;
      cursor: pointer;
      transition: all 0.3s ease;
      text-transform: uppercase;
      letter-spacing: 1px;
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.2);
      min-width: 200px;
    }

    .btn-skip {
      background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
      color: white;
      border: 3px solid #a93226;
    }

    .btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
    }

    .btn:active {
      transform: translateY(-1px);
    }

    /* Grade Level Buttons */
    .btn-level {
      background: linear-gradient(135deg, #8e44ad 0%, #7d3c98 100%);
      color: white;
      border: 3px solid #6c3483;
      font-size: 1rem;
      padding: 12px 20px;
      margin: 5px;
      border-radius: 25px;
      transition: all 0.3s ease;
      min-width: 120px;
    }

    .btn-level:hover {
      background: linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%);
      transform: translateY(-2px);
    }

    .btn-level.active {
      background: linear-gradient(135deg, #27ae60 0%, #219a52 100%);
      border-color: #1e8449;
    }

    /* Speech Recognition Status */
    .speech-status {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 1000;
      padding: 16px 24px;
      border-radius: 50px;
      font-weight: 700;
      font-size: 1.1rem;
      transition: all 0.3s ease;
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
      border: 3px solid transparent;
    }

    .speech-status.listening {
      background: linear-gradient(135deg, #27ae60 0%, #219a52 100%);
      color: white;
      border-color: #1e8449;
      animation: pulse 1.5s infinite;
    }

    .speech-status.processing {
      background: linear-gradient(135deg, #f39c12 0%, #e08e0b 100%);
      color: white;
      border-color: #ca6f1e;
    }

    .speech-status.error {
      background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
      color: white;
      border-color: #a93226;
    }

    @keyframes pulse {
      0% { opacity: 1; transform: scale(1); }
      50% { opacity: 0.8; transform: scale(1.05); }
      100% { opacity: 1; transform: scale(1); }
    }

    /* Wins Display */
    .wins-counter {
      font-size: 3rem;
      font-weight: 900;
      color: white;
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
      display: inline-block;
      margin: 0 10px;
    }

    .wins-list {
      margin-top: 20px;
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      justify-content: center;
    }

    .win-item {
      background: rgba(255, 255, 255, 0.2);
      padding: 8px 16px;
      border-radius: 25px;
      font-size: 1.2rem;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 8px;
      border: 2px solid rgba(255, 255, 255, 0.3);
    }

    .win-icon {
      width: 24px;
      height: 24px;
      border-radius: 50%;
    }

    /* Skipped Words */
    .skipped-list {
      margin-top: 20px;
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      justify-content: center;
    }

    .skipped-item {
      background: rgba(255, 255, 255, 0.1);
      padding: 8px 16px;
      border-radius: 25px;
      font-size: 1.1rem;
      font-weight: 600;
      border: 2px solid rgba(255, 255, 255, 0.2);
    }

    /* Utility Classes */
    .text-center {
      text-align: center;
    }

    .hidden {
      display: none;
    }

    .mb-0 {
      margin-bottom: 0;
    }

    .mt-3 {
      margin-top: 1.5rem;
    }

    /* Responsive Design */
    @media (max-width: 768px) {
      .container {
        padding: 10px;
      }

      showSuccessAnimation() {
        // Create success overlay
        const successOverlay = document.createElement('div');
        successOverlay.className = 'success-overlay';
        successOverlay.style.cssText = `
          position: fixed;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          background: rgba(39, 174, 96, 0.9);
          display: flex;
          align-items: center;
          justify-content: center;
          z-index: 9999;
          animation: successFade 1.5s ease-out forwards;
        `;
        
        const successContent = document.createElement('div');
        successContent.style.cssText = `
          text-align: center;
          color: white;
          font-size: 4rem;
          font-weight: 900;
          text-shadow: 3px 3px 6px rgba(0, 0, 0, 0.3);
          animation: successBounce 1.5s ease-out forwards;
        `;
        successContent.innerHTML = `
          <div style="font-size: 6rem; margin-bottom: 20px;">🌟</div>
          <div>Excellent!</div>
          <div style="font-size: 2.5rem; margin-top: 10px;">"${this.currentWord}"</div>
        `;
        
        successOverlay.appendChild(successContent);
        document.body.appendChild(successOverlay);
        
        // Make the word display flash
        if (this.elements.wordPlace) {
          this.elements.wordPlace.style.animation = 'successFlash 1.5s ease-out';
        }
        
        // Remove overlay after animation
        setTimeout(() => {
          if (document.body.contains(successOverlay)) {
            document.body.removeChild(successOverlay);
          }
          if (this.elements.wordPlace) {
            this.elements.wordPlace.style.animation = '';
          }
        }, 1500);
      }

      showLevelChangeAnimation(levelName) {
        // Create level change overlay
        const levelOverlay = document.createElement('div');
        levelOverlay.className = 'level-change-overlay';
        levelOverlay.style.cssText = `
          position: fixed;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          background: rgba(74, 144, 226, 0.95);
          display: flex;
          align-items: center;
          justify-content: center;
          z-index: 9999;
          animation: levelChangeFade 1.5s ease-out forwards;
        `;
        
        const levelContent = document.createElement('div');
        levelContent.style.cssText = `
          text-align: center;
          color: white;
          font-size: 3rem;
          font-weight: 900;
          text-shadow: 3px 3px 6px rgba(0, 0, 0, 0.3);
          animation: levelChangeBounce 1.5s ease-out forwards;
        `;
        levelContent.innerHTML = `
          <div style="font-size: 5rem; margin-bottom: 20px;">📚</div>
          <div>Level Changed!</div>
          <div style="font-size: 2rem; margin-top: 10px;">${levelName}</div>
        `;
        
        levelOverlay.appendChild(levelContent);
        document.body.appendChild(levelOverlay);
        
        // Remove overlay after animation
        setTimeout(() => {
          if (document.body.contains(levelOverlay)) {
            document.body.removeChild(levelOverlay);
          }
        }, 1500);
      }

      tryLoadAudio(sources, index) {
        if (index >= sources.length) {
          console.warn('All audio sources failed to load');
          this.winSound = null; // Disable audio
          return;
        }

        this.winSound.src = sources[index];
        
        const tryNext = () => {
          console.warn(`Audio source ${sources[index]} failed, trying next...`);
          this.tryLoadAudio(sources, index + 1);
        };

        this.winSound.addEventListener('error', tryNext, { once: true });
        this.winSound.addEventListener('canplaythrough', () => {
          console.log(`Audio loaded successfully from: ${sources[index]}`);
        }, { once: true });

        // Test load
        this.winSound.load();
      }

      .row {
        margin: -5px;
      }

      .col {
        flex: 0 0 100%;
        min-width: auto;
        padding: 5px;
      }

      .card {
        padding: 16px;
        margin-bottom: 10px;
      }

      h1 {
        font-size: 2rem;
      }

      .word-display {
        font-size: clamp(3rem, 15vw, 8rem);
      }

      .btn {
        padding: 12px 24px;
        font-size: 1.2rem;
        min-width: 150px;
      }

      .wins-counter {
        font-size: 2rem;
      }

      .speech-status {
        top: 10px;
        right: 10px;
        padding: 12px 16px;
        font-size: 1rem;
      }
    }

    @media (max-width: 480px) {
      h1 {
        font-size: 1.8rem;
      }

      .btn {
        padding: 10px 20px;
        font-size: 1.1rem;
      }
    }

    /* Print Styles */
    @media print {
      .speech-status {
        display: none;
      }

      .card {
        box-shadow: none;
        border: 2px solid #333;
      }
    }

    /* Focus and Accessibility */
    .btn:focus,
    a:focus {
      outline: 3px solid #4a90e2;
      outline-offset: 2px;
    }

    /* High contrast mode support */
    @media (prefers-contrast: high) {
      .card {
        border-width: 4px;
      }
      
      a {
        border-bottom-width: 3px;
      }
    }

    /* Reduced motion support */
    @media (prefers-reduced-motion: reduce) {
      * {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
      }
    }

    /* Success Animation Keyframes */
    @keyframes successFade {
      0% { opacity: 0; }
      20% { opacity: 1; }
      80% { opacity: 1; }
      100% { opacity: 0; }
    }

    @keyframes successBounce {
      0% { transform: scale(0.3) rotateY(0deg); opacity: 0; }
      50% { transform: scale(1.1) rotateY(180deg); opacity: 1; }
      70% { transform: scale(0.9) rotateY(360deg); }
      100% { transform: scale(1) rotateY(360deg); opacity: 1; }
    }

    @keyframes successFlash {
      0% { background-color: transparent; }
      25% { background-color: rgba(39, 174, 96, 0.3); transform: scale(1.05); }
      50% { background-color: rgba(39, 174, 96, 0.5); transform: scale(1.1); }
      75% { background-color: rgba(39, 174, 96, 0.3); transform: scale(1.05); }
      100% { background-color: transparent; transform: scale(1); }
    }

    /* Level Change Animation Keyframes */
    @keyframes levelChangeFade {
      0% { opacity: 0; }
      20% { opacity: 1; }
      80% { opacity: 1; }
      100% { opacity: 0; }
    }

    @keyframes levelChangeBounce {
      0% { transform: scale(0.3) rotateX(0deg); opacity: 0; }
      50% { transform: scale(1.1) rotateX(180deg); opacity: 1; }
      70% { transform: scale(0.9) rotateX(360deg); }
      100% { transform: scale(1) rotateX(360deg); opacity: 1; }
    }
  </style>
  </style>
</head>

<body>
  <div class="container">
    <!-- Speech Recognition Status Indicator -->
    <div id="speechStatus" class="speech-status hidden"></div>
    
    <!-- Navigation Header -->
    <div class="row">
      <div class="col">
        <div class="card card-navigation">
          <h5>Choose Your Grade Level</h5>
          <div style="margin: 15px 0; display: flex; flex-wrap: wrap; gap: 10px; justify-content: center;">
            <button class="btn btn-level" data-level="preprimer">Pre-School</button>
            <button class="btn btn-level" data-level="primer">Kindergarten</button>
          </div>
          <div style="display: flex; flex-wrap: wrap; gap: 10px; justify-content: center;">
            <button class="btn btn-level" data-level="first">1st Grade</button>
            <button class="btn btn-level" data-level="second">2nd Grade</button>
            <button class="btn btn-level" data-level="third">3rd Grade</button>
          </div>
        </div>
      </div>
      
      <div class="col">
        <div class="card card-title">
          <h1>SightWords Friend</h1>
        </div>
      </div>
    </div>

    <!-- Main Game Area -->
    <div class="row">
      <div class="col-full">
        <div class="card card-game">
          <div id="currentLevel" class="text-center" style="font-size: 1.5rem; font-weight: 700; margin-bottom: 20px; opacity: 0.9;">
            Current Level: Kindergarten (Primer)
          </div>
          <h3>Say this word:</h3>
          <div id="wordplace" class="word-display" aria-live="polite" aria-label="Current word to say"></div>
          <div class="text-center">
            <button id="skipBtn" class="btn btn-skip" aria-label="Skip current word">
              ⏭️ Skip Word
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Wins Tracker -->
    <div class="row">
      <div class="col-full">
        <div class="card card-wins">
          <h3 class="mb-0">
            🎉 Track your wins here: 
            <span id="winsnum" class="wins-counter" aria-live="polite">0</span>
          </h3>
          <div id="wins" class="wins-list" aria-live="polite" aria-label="Words completed successfully"></div>
        </div>
      </div>
    </div>

    <!-- Skipped Words -->
    <div class="row">
      <div class="col-full">
        <div class="card card-skipped">
          <h4 class="mb-0">
            📚 Words I need help with...
          </h4>
          <div id="skipped" class="skipped-list" aria-live="polite" aria-label="Words that were skipped"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Annyang Speech Recognition -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/annyang/2.6.1/annyang.min.js"></script>

  <script>
    // SightWords Game Class - Modern ES6+ Implementation
    class SightWordsGame {
      constructor() {
        // Word arrays for different grade levels
        this.wordLists = {
          preprimer: ["the", "to", "and", "a", "I", "you", "it", "in", "said", "for", "up", "look", "is", "go", "we", "little", "down", "can", "see", "not", "one", "my", "me", "big", "come", "blue", "red", "where", "jump", "away", "here", "help", "make", "yellow", "two", "play", "run", "find", "three", "funny"],
          primer: ["he", "was", "that", "she", "on", "they", "but", "at", "with", "all", "there", "out", "be", "have", "am", "do", "did", "what", "so", "get", "like", "this", "will", "yes", "went", "are", "now", "no", "come", "ride", "into", "good", "want", "too", "pretty", "four", "saw", "well", "ran", "brown", "eat", "who", "new", "must", "black", "white", "soon", "our", "ate", "say", "under", "please"],
          first: ["of", "his", "head", "him", "her", "some", "as", "then", "could", "when", "were", "them", "ask", "an", "over", "just", "from", "any", "how", "know", "put", "take", "every", "old", "by", "after", "think", "let", "going", "walk", "again", "may", "stop", "fly", "round", "give", "once", "open", "has", "live", "thank"],
          second: ["always", "around", "because", "been", "before", "best", "both", "buy", "call", "cold", "does", "don't", "fast", "first", "five", "found", "gave", "goes", "green", "its", "made", "many", "off", "or", "pull", "read", "right", "sing", "sit", "sleep", "tell", "their", "these", "those", "upon", "us", "use", "very", "wash", "which", "why", "wish", "work", "would", "write", "your"],
          third: ["about", "better", "bring", "carry", "clean", "cut", "done", "draw", "drink", "eight", "fall", "far", "full", "got", "grow", "hold", "hot", "hurt", "if", "keep", "kind", "laugh", "light", "long", "much", "myself", "never", "only", "own", "pick", "seven", "shall", "show", "six", "small", "start", "ten", "today", "together", "try", "warm"]
        };

        // Game state
        this.currentWord = null;
        this.winsCount = 0;
        this.skippedWords = [];
        this.currentLevel = 'primer'; // Track current level
        this.currentWordList = this.wordLists.primer; // Default to kindergarten level
        this.speechRecognitionStopped = false; // Track if we manually stopped recognition
        
        // Level display names
        this.levelNames = {
          preprimer: 'Pre-School (Pre-Primer)',
          primer: 'Kindergarten (Primer)', 
          first: '1st Grade',
          second: '2nd Grade',
          third: '3rd Grade'
        };
        
        // DOM elements
        this.elements = {
          wordPlace: document.getElementById('wordplace'),
          skipBtn: document.getElementById('skipBtn'),
          winsNum: document.getElementById('winsnum'),
          wins: document.getElementById('wins'),
          skipped: document.getElementById('skipped'),
          speechStatus: document.getElementById('speechStatus'),
          currentLevel: document.getElementById('currentLevel')
        };

        this.init();
      }

      init() {
        // Set up event listeners
        this.elements.skipBtn.addEventListener('click', () => this.skipWord());
        
        // Add grade level navigation listeners
        document.querySelectorAll('[data-level]').forEach(button => {
          button.addEventListener('click', (e) => {
            const level = e.target.getAttribute('data-level');
            this.setWordList(level);
          });
        });
        
        // Add keyboard support
        document.addEventListener('keydown', (e) => {
          if (e.key === ' ' || e.key === 'Spacebar') {
            e.preventDefault();
            this.skipWord();
          }
        });

        // Handle audio loading errors - No longer needed
        // this.winSound.addEventListener('error', () => {
        //   console.warn('Win sound could not be loaded');
        // });

        // Start the game
        this.selectWord();
      }

      selectWord() {
        // Select random word from current word list
        const randomIndex = Math.floor(Math.random() * this.currentWordList.length);
        this.currentWord = this.currentWordList[randomIndex];
        
        console.log('Selected word:', this.currentWord);
        
        // Update UI
        this.elements.wordPlace.textContent = this.currentWord;
        
        // Set up speech recognition for this word
        this.setupSpeechRecognition();
      }

      setupSpeechRecognition() {
        if (typeof annyang === 'undefined') {
          console.error('Annyang not loaded');
          this.showSpeechStatus('❌ Speech recognition not available', 'error');
          return;
        }

        // Reset recognition state
        this.speechRecognitionStopped = false;

        // Clear previous commands and callbacks
        annyang.removeCommands();
        annyang.removeCallback();
        
        // Create command for current word
        const commands = {};
        commands[this.currentWord] = () => this.handleCorrectWord();
        
        // Add command and start listening
        annyang.addCommands(commands);
        
        // Set up event listeners for visual feedback
        annyang.addCallback('start', () => {
          this.showSpeechStatus('🎤 Listening...', 'listening');
        });
        
        annyang.addCallback('soundstart', () => {
          this.showSpeechStatus('🔊 Processing...', 'processing');
        });
        
        annyang.addCallback('result', (phrases) => {
          console.log('Speech recognition result:', phrases);
          this.showSpeechStatus('✅ Got it!', 'listening');
          setTimeout(() => this.hideSpeechStatus(), 1000);
        });
        
        annyang.addCallback('error', (err) => {
          let errorMessage = 'Try again';
          let errorType = 'error';
          
          if (err && err.error) {
            switch (err.error) {
              case 'no-speech':
                errorMessage = '🎤 No speech detected';
                errorType = 'listening';
                break;
              case 'audio-capture':
                errorMessage = '❌ Microphone not available';
                errorType = 'error';
                break;
              case 'not-allowed':
                errorMessage = '❌ Microphone permission denied';
                errorType = 'error';
                break;
              case 'network':
                errorMessage = '❌ Network error';
                errorType = 'error';
                break;
              case 'aborted':
                errorMessage = '⏹️ Speech recognition stopped';
                errorType = 'processing';
                break;
              default:
                errorMessage = `❌ ${err.error}`;
                errorType = 'error';
            }
            console.warn(`Speech recognition error: ${err.error}`);
          } else {
            console.warn('Speech recognition error:', err);
          }
          
          this.showSpeechStatus(errorMessage, errorType);
          
          // Only show temporary message for non-critical errors
          if (err && err.error !== 'no-speech') {
            setTimeout(() => this.hideSpeechStatus(), 3000);
          } else {
            setTimeout(() => this.hideSpeechStatus(), 1000);
          }
        });

        annyang.addCallback('end', () => {
          // Only restart if we haven't manually stopped and no critical errors occurred
          if (annyang.isListening() && !this.speechRecognitionStopped) {
            setTimeout(() => {
              try {
                annyang.start();
              } catch (error) {
                console.warn('Could not restart speech recognition:', error);
                this.showSpeechStatus('🔄 Tap to restart listening', 'error');
                // Add click to restart functionality
                if (this.elements.speechStatus) {
                  this.elements.speechStatus.style.cursor = 'pointer';
                  this.elements.speechStatus.onclick = () => {
                    this.setupSpeechRecognition();
                    this.elements.speechStatus.onclick = null;
                    this.elements.speechStatus.style.cursor = 'default';
                  };
                }
              }
            }, 500); // Increased delay to prevent rapid restart loops
          }
        });

        // Start listening
        try {
          annyang.start();
          console.log('Speech recognition started successfully');
        } catch (error) {
          console.error('Failed to start speech recognition:', error);
          this.showSpeechStatus('❌ Click to start listening', 'error');
          // Make status clickable to retry
          if (this.elements.speechStatus) {
            this.elements.speechStatus.style.cursor = 'pointer';
            this.elements.speechStatus.onclick = () => {
              this.setupSpeechRecognition();
              this.elements.speechStatus.onclick = null;
              this.elements.speechStatus.style.cursor = 'default';
            };
          }
        }
      }

      handleCorrectWord() {
        this.winsCount++;
        this.addWin();
        
        // Show visual success feedback
        this.showSuccessAnimation();
        
        // Show success feedback in speech status
        this.showSpeechStatus('🎉 Correct!', 'listening');
        
        // Move to next word after brief delay
        setTimeout(() => {
          this.selectWord();
        }, 1500);
      }

      addWin() {
        // Update wins counter
        this.elements.winsNum.textContent = this.winsCount;
        
        // Add word to wins display
        const winElement = document.createElement('div');
        winElement.className = 'win-item';
        winElement.innerHTML = `
          <span>${this.currentWord}</span>
          <span class="win-icon" style="background: #27ae60; color: white; display: flex; align-items: center; justify-content: center; font-size: 12px;">✓</span>
        `;
        
        this.elements.wins.appendChild(winElement);
      }

      skipWord() {
        // Add to skipped words
        this.skippedWords.push(this.currentWord);
        
        // Update skipped words display
        const skipElement = document.createElement('div');
        skipElement.className = 'skipped-item';
        skipElement.textContent = this.currentWord;
        
        this.elements.skipped.appendChild(skipElement);
        
        // Move to next word
        this.selectWord();
      }

      showSpeechStatus(message, type) {
        if (this.elements.speechStatus) {
          this.elements.speechStatus.textContent = message;
          this.elements.speechStatus.className = `speech-status ${type}`;
          this.elements.speechStatus.classList.remove('hidden');
        }
      }

      hideSpeechStatus() {
        if (this.elements.speechStatus) {
          this.elements.speechStatus.classList.add('hidden');
        }
      }

      // Method to change word list (for different grade levels)
      setWordList(level) {
        if (this.wordLists[level]) {
          // Stop current speech recognition
          this.speechRecognitionStopped = true;
          if (typeof annyang !== 'undefined') {
            annyang.abort();
          }

          this.currentLevel = level;
          this.currentWordList = this.wordLists[level];
          
          // Update level display
          this.elements.currentLevel.textContent = `Current Level: ${this.levelNames[level]}`;
          
          // Update button states
          document.querySelectorAll('[data-level]').forEach(button => {
            button.classList.remove('active');
          });
          const activeButton = document.querySelector(`[data-level="${level}"]`);
          if (activeButton) {
            activeButton.classList.add('active');
          }
          
          // Reset counters for new level
          this.winsCount = 0;
          this.skippedWords = [];
          this.elements.winsNum.textContent = '0';
          this.elements.wins.innerHTML = '';
          this.elements.skipped.innerHTML = '';
          
          // Show level change animation
          this.showLevelChangeAnimation(this.levelNames[level]);
          
          // Start with new word list
          setTimeout(() => {
            this.selectWord();
          }, 1500);
        } else {
          console.error(`Word list '${level}' not found`);
        }
      }
    }

    // Initialize the game when DOM is loaded
    document.addEventListener('DOMContentLoaded', () => {
      // Check if annyang is available
      if (typeof annyang === 'undefined') {
        console.error('Annyang library not loaded');
        const statusEl = document.getElementById('speechStatus');
        if (statusEl) {
          statusEl.textContent = '❌ Speech recognition not available';
          statusEl.className = 'speech-status error';
          statusEl.classList.remove('hidden');
        }
        return;
      }

      // Check for microphone permissions and browser support
      if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {
        console.warn('Speech recognition not supported in this browser');
        const statusEl = document.getElementById('speechStatus');
        if (statusEl) {
          statusEl.textContent = '❌ Speech recognition not supported';
          statusEl.className = 'speech-status error';
          statusEl.classList.remove('hidden');
        }
      }

      // Start the game
      window.sightWordsGame = new SightWordsGame();
      
      // Set initial active button
      const initialButton = document.querySelector('[data-level="primer"]');
      if (initialButton) {
        initialButton.classList.add('active');
      }
    });
  </script>
</body>

</html>